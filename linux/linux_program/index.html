



<!doctype html>
<html lang="zh" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
        <meta name="description" content="Atticus's Docs">
      
      
      
        <meta name="author" content="Atticus">
      
      
        <meta name="lang:clipboard.copy" content="复制">
      
        <meta name="lang:clipboard.copied" content="已复制">
      
        <meta name="lang:search.language" content="jp">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="没有找到符合条件的结果">
      
        <meta name="lang:search.result.one" content="找到 1 个符合条件的结果">
      
        <meta name="lang:search.result.other" content="# 个符合条件的结果">
      
        <meta name="lang:search.tokenizer" content="[\uff0c\u3002]+">
      
      <link rel="shortcut icon" href="../../favicon.ico">
      <meta name="generator" content="mkdocs-1.0.4, mkdocs-material-4.4.3">
    
    
      
        <title>Linux编程基础 - Stack Pub</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/application.30686662.css">
      
        <link rel="stylesheet" href="../../assets/stylesheets/application-palette.a8b3c06d.css">
      
      
    
    
      <script src="../../assets/javascripts/modernizr.74668098.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Fira+Sans:300,400,400i,700|Fira+Mono&display=fallback">
        <style>body,input{font-family:"Fira Sans","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Fira Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../../assets/fonts/material-icons.css">
    
      <link rel="manifest" href="../../manifest.webmanifest">
    
    
    
      
    
    
  </head>
  
    
    
    <body dir="ltr" data-md-color-primary="" data-md-color-accent="pink">
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448" viewBox="0 0 416 448" id="__github"><path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"/></svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#_1" tabindex="1" class="md-skip">
        跳转至
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="../.." title="Stack Pub" class="md-header-nav__button md-logo">
          
            <i class="md-icon"></i>
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            <span class="md-header-nav__topic">
              Stack Pub
            </span>
            <span class="md-header-nav__topic">
              
                Linux编程基础
              
            </span>
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
          
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="搜索" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            键入以开始搜索
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            


  

<a href="https://github.com/opfanswyx/StackPub/" title="前往 Github 仓库" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    Atticus/Stack Pub
  </div>
</a>
          </div>
        </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
        

  

<nav class="md-tabs md-tabs--active" data-md-component="tabs">
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">
      
        
  <li class="md-tabs__item">
    
      <a href="../.." class="md-tabs__link">
        Hello World
      </a>
    
  </li>

      
        
  
  
    
    
  
  
    <li class="md-tabs__item">
      
        <a href="../../cprogram/c_base/" class="md-tabs__link">
          编程语言
        </a>
      
    </li>
  

  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../algorithm/struct_linkedlist/" class="md-tabs__link">
          数据结构与算法
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../plan/" class="md-tabs__link md-tabs__link--active">
          Linux
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../network/plan/" class="md-tabs__link">
          网络
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../database/plan/" class="md-tabs__link">
          数据库
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../source/plan/" class="md-tabs__link">
          开源项目
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../math/plan/" class="md-tabs__link">
          数学
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../unity/List/" class="md-tabs__link">
          图形学
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../kit/Note/" class="md-tabs__link">
          Kit
        </a>
      
    </li>
  

      
    </ul>
  </div>
</nav>
      
      <main class="md-main" role="main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="../.." title="Stack Pub" class="md-nav__button md-logo">
      
        <i class="md-icon"></i>
      
    </a>
    Stack Pub
  </label>
  
    <div class="md-nav__source">
      


  

<a href="https://github.com/opfanswyx/StackPub/" title="前往 Github 仓库" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    Atticus/Stack Pub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../.." title="Hello World" class="md-nav__link">
      Hello World
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2">
    
    <label class="md-nav__link" for="nav-2">
      编程语言
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        编程语言
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2-1" type="checkbox" id="nav-2-1">
    
    <label class="md-nav__link" for="nav-2-1">
      C语言
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-2-1">
        C语言
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../cprogram/c_base/" title="C语言基础" class="md-nav__link">
      C语言基础
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cprogram/c_object/" title="C语言与面向对象" class="md-nav__link">
      C语言与面向对象
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cprogram/c_design/" title="C语言设计模式" class="md-nav__link">
      C语言设计模式
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2-2" type="checkbox" id="nav-2-2">
    
    <label class="md-nav__link" for="nav-2-2">
      C Plus Plus
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-2-2">
        C Plus Plus
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../cplus/cpp_base/" title="C++基础" class="md-nav__link">
      C++基础
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cplus/cpp_object/" title="类和对象" class="md-nav__link">
      类和对象
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cplus/cpp_quote/" title="引用" class="md-nav__link">
      引用
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cplus/cpp_inher/" title="继承与派生" class="md-nav__link">
      继承与派生
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cplus/cpp_polym/" title="多态与虚函数" class="md-nav__link">
      多态与虚函数
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cplus/cpp_ysfcz/" title="运算符重载" class="md-nav__link">
      运算符重载
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cplus/cpp_muban/" title="模板" class="md-nav__link">
      模板
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cplus/cpp_catch/" title="异常" class="md-nav__link">
      异常
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2-2-9" type="checkbox" id="nav-2-2-9">
    
    <label class="md-nav__link" for="nav-2-2-9">
      STL
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="3">
      <label class="md-nav__title" for="nav-2-2-9">
        STL
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../cplus/stl/cpp_stl/" title="STL基础" class="md-nav__link">
      STL基础
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cplus/stl/cpp_stl_vector/" title="vector" class="md-nav__link">
      vector
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cplus/stl/cpp_stl_list/" title="list" class="md-nav__link">
      list
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cplus/stl/cpp_stl_deque/" title="deque" class="md-nav__link">
      deque
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cplus/stl/cpp_stl_funcobject/" title="函数对象" class="md-nav__link">
      函数对象
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cplus/stl/cpp_stl_pair/" title="关联容器与pair类模板" class="md-nav__link">
      关联容器与pair类模板
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cplus/stl/cpp_stl_multiset/" title="multiset" class="md-nav__link">
      multiset
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cplus/stl/cpp_stl_set/" title="set" class="md-nav__link">
      set
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cplus/stl/cpp_stl_multimap/" title="multimap" class="md-nav__link">
      multimap
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cplus/stl/cpp_stl_map/" title="map" class="md-nav__link">
      map
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cplus/stl/cpp_stl_stack/" title="stack" class="md-nav__link">
      stack
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cplus/stl/cpp_stl_queue/" title="queue和priority_queue" class="md-nav__link">
      queue和priority_queue
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cplus/stl/cpp_stl_algo/" title="STL算法分类" class="md-nav__link">
      STL算法分类
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cplus/stl/cpp_stl_string/" title="string类" class="md-nav__link">
      string类
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cplus/stl/cpp_stl_bitset/" title="bitset类" class="md-nav__link">
      bitset类
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cplus/cpp_io/" title="输入输出流" class="md-nav__link">
      输入输出流
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cplus/cpp_file/" title="文件操作" class="md-nav__link">
      文件操作
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cplus/cpp_high/" title="高级主题" class="md-nav__link">
      高级主题
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2-3" type="checkbox" id="nav-2-3">
    
    <label class="md-nav__link" for="nav-2-3">
      Go语言
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-2-3">
        Go语言
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../goprogram/plan/" title="规划" class="md-nav__link">
      规划
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../source/php/php_summary/" title="PHP总结" class="md-nav__link">
      PHP总结
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../source/lua/lua_summary/" title="Lua总结" class="md-nav__link">
      Lua总结
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3">
    
    <label class="md-nav__link" for="nav-3">
      数据结构与算法
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        数据结构与算法
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../algorithm/struct_linkedlist/" title="链表" class="md-nav__link">
      链表
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../algorithm/struct_stack_queue/" title="栈与队列" class="md-nav__link">
      栈与队列
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../algorithm/struct_tree/" title="树🌲" class="md-nav__link">
      树🌲
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../algorithm/struct_graph/" title="图" class="md-nav__link">
      图
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../algorithm/algo_pattern/" title="模式匹配" class="md-nav__link">
      模式匹配
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../algorithm/algo_sort/" title="排序" class="md-nav__link">
      排序
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../algorithm/algo_sort/" title="查找" class="md-nav__link">
      查找
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../algorithm/algo_sort/" title="数据压缩" class="md-nav__link">
      数据压缩
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../algorithm/algo_sort/" title="内存管理" class="md-nav__link">
      内存管理
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../algorithm/algo_sort/" title="动态规划" class="md-nav__link">
      动态规划
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4" checked>
    
    <label class="md-nav__link" for="nav-4">
      Linux
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        Linux
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../plan/" title="规划" class="md-nav__link">
      规划
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../linux_base/" title="Linux基础" class="md-nav__link">
      Linux基础
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Linux编程基础
      </label>
    
    <a href="./" title="Linux编程基础" class="md-nav__link md-nav__link--active">
      Linux编程基础
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
  
    <label class="md-nav__title" for="__toc">目录</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    文件操作
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    底层文件访问
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#io" class="md-nav__link">
    标准I/O
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_3" class="md-nav__link">
    格式化输入输出
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_4" class="md-nav__link">
    文件和目录维护
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_5" class="md-nav__link">
    扫描目录
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_6" class="md-nav__link">
    错误处理
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#proc" class="md-nav__link">
    /proc文件系统
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fcntlmmap" class="md-nav__link">
    fcntl和mmap
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#linux" class="md-nav__link">
    Linux环境
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_7" class="md-nav__link">
    日志
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_8" class="md-nav__link">
    数据管理
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_9" class="md-nav__link">
    文件锁定
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#mysql" class="md-nav__link">
    MySQL
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_10" class="md-nav__link">
    连接
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_11" class="md-nav__link">
    错误处理
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_12" class="md-nav__link">
    执行
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#updatedeleteinsert" class="md-nav__link">
    不返回数据的语句UPDATE,DELETE,INSERT
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_13" class="md-nav__link">
    返回数据的语句
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_14" class="md-nav__link">
    开发工具
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#make" class="md-nav__link">
    make
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#makefile" class="md-nav__link">
    makefile
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_15" class="md-nav__link">
    后缀和模式规则
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#makefile_1" class="md-nav__link">
    makefile文件和子目录
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_16" class="md-nav__link">
    调试
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_17" class="md-nav__link">
    预处理&amp;宏
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#gdb" class="md-nav__link">
    GDB调试
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_18" class="md-nav__link">
    进程与信号
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#exec" class="md-nav__link">
    替换进程映像exec系列函数
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fork" class="md-nav__link">
    复制进程映像fork
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_19" class="md-nav__link">
    信号
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#posix" class="md-nav__link">
    POSIX线程
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_20" class="md-nav__link">
    同步
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_21" class="md-nav__link">
    信号量
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_22" class="md-nav__link">
    互斥量
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_23" class="md-nav__link">
    线程属性
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_24" class="md-nav__link">
    进程间通信：管道
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_25" class="md-nav__link">
    进程管道
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pipe" class="md-nav__link">
    底层的pipe函数
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_26" class="md-nav__link">
    命名管道(不先关的进程之间)
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_27" class="md-nav__link">
    信号量、共享内存和消息队列
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_28" class="md-nav__link">
    信号量
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_29" class="md-nav__link">
    共享内存
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_30" class="md-nav__link">
    消息队列
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_31" class="md-nav__link">
    套接字
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_32" class="md-nav__link">
    命名套接字
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_33" class="md-nav__link">
    创建套接字队列
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_34" class="md-nav__link">
    接受连接
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_35" class="md-nav__link">
    请求连接
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_36" class="md-nav__link">
    主机字节序和网络字节序
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_37" class="md-nav__link">
    套接字选项
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#select" class="md-nav__link">
    select系统调用
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5" type="checkbox" id="nav-5">
    
    <label class="md-nav__link" for="nav-5">
      网络
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-5">
        网络
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../network/plan/" title="规划" class="md-nav__link">
      规划
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-6" type="checkbox" id="nav-6">
    
    <label class="md-nav__link" for="nav-6">
      数据库
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-6">
        数据库
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../database/plan/" title="规划" class="md-nav__link">
      规划
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-7" type="checkbox" id="nav-7">
    
    <label class="md-nav__link" for="nav-7">
      开源项目
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-7">
        开源项目
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../source/plan/" title="规划" class="md-nav__link">
      规划
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-7-2" type="checkbox" id="nav-7-2">
    
    <label class="md-nav__link" for="nav-7-2">
      Nginx
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-7-2">
        Nginx
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../source/nginx/nginx_base/" title="Nginx基础" class="md-nav__link">
      Nginx基础
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-7-3" type="checkbox" id="nav-7-3">
    
    <label class="md-nav__link" for="nav-7-3">
      Redis
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-7-3">
        Redis
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../source/redis/redis_base/" title="Redis基础" class="md-nav__link">
      Redis基础
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../source/tinyhttpd/" title="TinyHttpd" class="md-nav__link">
      TinyHttpd
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-8" type="checkbox" id="nav-8">
    
    <label class="md-nav__link" for="nav-8">
      数学
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-8">
        数学
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../math/plan/" title="规划" class="md-nav__link">
      规划
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-9" type="checkbox" id="nav-9">
    
    <label class="md-nav__link" for="nav-9">
      图形学
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-9">
        图形学
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../unity/List/" title="规划" class="md-nav__link">
      规划
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../unity/unity_base/" title="Unity基础" class="md-nav__link">
      Unity基础
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../unity/unity_shader/" title="Shader" class="md-nav__link">
      Shader
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-10" type="checkbox" id="nav-10">
    
    <label class="md-nav__link" for="nav-10">
      Kit
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-10">
        Kit
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../kit/Note/" title="计划" class="md-nav__link">
      计划
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../kit/mkdocs/" title="基于mkdocs的blog搭建" class="md-nav__link">
      基于mkdocs的blog搭建
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../kit/vim/" title="VIM常用技巧" class="md-nav__link">
      VIM常用技巧
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../kit/gdb/" title="GDB调试的基本使用" class="md-nav__link">
      GDB调试的基本使用
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../kit/book/" title="书籍📚推荐" class="md-nav__link">
      书籍📚推荐
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../kit/tmux/" title="tmux基本技巧" class="md-nav__link">
      tmux基本技巧
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
  
    <label class="md-nav__title" for="__toc">目录</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    文件操作
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    底层文件访问
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#io" class="md-nav__link">
    标准I/O
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_3" class="md-nav__link">
    格式化输入输出
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_4" class="md-nav__link">
    文件和目录维护
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_5" class="md-nav__link">
    扫描目录
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_6" class="md-nav__link">
    错误处理
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#proc" class="md-nav__link">
    /proc文件系统
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fcntlmmap" class="md-nav__link">
    fcntl和mmap
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#linux" class="md-nav__link">
    Linux环境
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_7" class="md-nav__link">
    日志
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_8" class="md-nav__link">
    数据管理
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_9" class="md-nav__link">
    文件锁定
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#mysql" class="md-nav__link">
    MySQL
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_10" class="md-nav__link">
    连接
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_11" class="md-nav__link">
    错误处理
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_12" class="md-nav__link">
    执行
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#updatedeleteinsert" class="md-nav__link">
    不返回数据的语句UPDATE,DELETE,INSERT
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_13" class="md-nav__link">
    返回数据的语句
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_14" class="md-nav__link">
    开发工具
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#make" class="md-nav__link">
    make
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#makefile" class="md-nav__link">
    makefile
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_15" class="md-nav__link">
    后缀和模式规则
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#makefile_1" class="md-nav__link">
    makefile文件和子目录
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_16" class="md-nav__link">
    调试
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_17" class="md-nav__link">
    预处理&amp;宏
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#gdb" class="md-nav__link">
    GDB调试
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_18" class="md-nav__link">
    进程与信号
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#exec" class="md-nav__link">
    替换进程映像exec系列函数
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fork" class="md-nav__link">
    复制进程映像fork
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_19" class="md-nav__link">
    信号
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#posix" class="md-nav__link">
    POSIX线程
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_20" class="md-nav__link">
    同步
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_21" class="md-nav__link">
    信号量
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_22" class="md-nav__link">
    互斥量
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_23" class="md-nav__link">
    线程属性
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_24" class="md-nav__link">
    进程间通信：管道
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_25" class="md-nav__link">
    进程管道
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pipe" class="md-nav__link">
    底层的pipe函数
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_26" class="md-nav__link">
    命名管道(不先关的进程之间)
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_27" class="md-nav__link">
    信号量、共享内存和消息队列
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_28" class="md-nav__link">
    信号量
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_29" class="md-nav__link">
    共享内存
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_30" class="md-nav__link">
    消息队列
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_31" class="md-nav__link">
    套接字
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_32" class="md-nav__link">
    命名套接字
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_33" class="md-nav__link">
    创建套接字队列
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_34" class="md-nav__link">
    接受连接
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_35" class="md-nav__link">
    请求连接
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_36" class="md-nav__link">
    主机字节序和网络字节序
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_37" class="md-nav__link">
    套接字选项
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#select" class="md-nav__link">
    select系统调用
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/opfanswyx/StackPub/edit/master/docs/linux/linux_program.md" title="编辑此页" class="md-icon md-content__icon">&#xE3C9;</a>
                
                
                  <h1>Linux编程基础</h1>
                
                <table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="o">/</span><span class="n">bin</span>    <span class="c1">//二进制文件目录，用于存放启动系统程序的标准路径</span>
<span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">bin</span>    <span class="c1">//用户二进制文件路径，用于存放用户使用的标准程序</span>
<span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span>  <span class="c1">//本地二进制文件目录，用于存放软件安装程序</span>
</pre></div>
</td></tr></table>

<p>对于c语言来说，头文件几乎总是位于/usr/include目录及其子目录中。</p>
<p>标准系统库文件一般存储在/lib和/usr/lib目录中。</p>
<p>终极命令
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="err">$</span> <span class="n">man</span>
<span class="err">$</span> <span class="n">info</span>
</pre></div>
</td></tr></table></p>
<h2 id="_1">文件操作<a class="headerlink" href="#_1" title="Permanent link">&para;</a></h2>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">console</span>    <span class="c1">//系统控制台</span>
<span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">tty</span>        <span class="c1">//控制终端</span>
<span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">null</span>   
</pre></div>
</td></tr></table>

<h3 id="_2">底层文件访问<a class="headerlink" href="#_2" title="Permanent link">&para;</a></h3>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="cp">#include</span><span class="cpf">&lt;unistd.h&gt;</span><span class="cp"></span>
<span class="kt">size_t</span> <span class="nf">write</span><span class="p">(</span><span class="kt">int</span> <span class="n">fildes</span><span class="p">,</span> <span class="k">const</span> <span class="kt">void</span> <span class="o">*</span><span class="n">buf</span><span class="p">,</span> <span class="kt">size_t</span> <span class="n">nbytes</span><span class="p">);</span>   <span class="c1">//把缓冲区buf前nbytes个字节写入与文件描述符fildes关联的文件中。</span>
<span class="kt">size_t</span> <span class="nf">read</span><span class="p">(</span><span class="kt">int</span> <span class="n">fildes</span><span class="p">,</span> <span class="kt">void</span> <span class="o">*</span><span class="n">buf</span><span class="p">,</span> <span class="kt">size_t</span> <span class="n">nbytes</span><span class="p">);</span>  <span class="c1">//从文件描述符fildes相关的文件里读入nbytes个字节数据，存放到buf中。</span>
<span class="kt">int</span> <span class="nf">close</span><span class="p">(</span><span class="kt">int</span> <span class="n">fildes</span><span class="p">);</span>
<span class="cp">#include</span><span class="cpf">&lt;fcntl.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span><span class="cpf">&lt;sys/types.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span><span class="cpf">&lt;sys/stat.h&gt;</span><span class="cp"></span>
<span class="kt">int</span> <span class="nf">open</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">path</span><span class="p">,</span> <span class="kt">int</span> <span class="n">oflags</span><span class="p">);</span>
<span class="kt">int</span> <span class="nf">open</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">path</span><span class="p">,</span> <span class="kt">int</span> <span class="n">oflags</span><span class="p">,</span> <span class="kt">mode_t</span> <span class="n">mode</span><span class="p">);</span>

<span class="kt">off_t</span> <span class="nf">lseek</span><span class="p">(</span><span class="kt">int</span> <span class="n">fildes</span><span class="p">,</span> <span class="kt">off_t</span> <span class="n">offset</span><span class="p">,</span> <span class="kt">int</span> <span class="n">whence</span><span class="p">);</span>  <span class="c1">//对文件描述符fildes的读写指针进行设置。</span>
<span class="kt">int</span> <span class="nf">fstat</span><span class="p">(</span><span class="kt">int</span> <span class="n">fildes</span><span class="p">,</span> <span class="k">struct</span> <span class="n">stat</span> <span class="o">*</span><span class="n">buf</span><span class="p">);</span>    <span class="c1">//返回与打开文件描述符相关的文件的状态信息，写入buf结构</span>
<span class="kt">int</span> <span class="nf">stat</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">path</span><span class="p">,</span> <span class="k">struct</span> <span class="n">stat</span> <span class="o">*</span><span class="n">buf</span><span class="p">);</span>   <span class="c1">//当文件是一个符号链接时，返回该符号链接指向的文件的信息。</span>
<span class="kt">int</span> <span class="nf">lstat</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">path</span><span class="p">,</span> <span class="k">struct</span> <span class="n">stat</span> <span class="o">*</span><span class="n">buf</span><span class="p">);</span>  <span class="c1">//当文件是一个符号链接时，返回该符号链接本身的信息。</span>

<span class="kt">int</span> <span class="nf">dup</span><span class="p">(</span><span class="kt">int</span> <span class="n">fildes</span><span class="p">);</span>        <span class="c1">//赋值文件描述符fildes，返回一个新文件描述符</span>
<span class="kt">int</span> <span class="nf">dup2</span><span class="p">(</span><span class="kt">int</span> <span class="n">fildes</span><span class="p">,</span> <span class="kt">int</span> <span class="n">fildes2</span><span class="p">);</span>  <span class="c1">//通过明确指定木办法描述符来把一个文件描述符复制为另外一个</span>
</pre></div>
</td></tr></table>

<h3 id="io">标准I/O<a class="headerlink" href="#io" title="Permanent link">&para;</a></h3>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="c1">//stdin,stdout,stderr</span>
<span class="cp">#include</span><span class="cpf">&lt;stdio.h&gt;</span><span class="cp"></span>
<span class="kt">FILE</span> <span class="o">*</span><span class="nf">fopen</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">filename</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">mode</span><span class="p">);</span>
<span class="kt">size_t</span> <span class="nf">fread</span><span class="p">(</span><span class="kt">void</span> <span class="o">*</span><span class="n">ptr</span><span class="p">,</span> <span class="kt">size_t</span> <span class="n">size</span><span class="p">,</span> <span class="kt">size_t</span> <span class="n">nitems</span><span class="p">,</span> <span class="kt">FILE</span> <span class="o">*</span><span class="n">stream</span><span class="p">);</span>  <span class="c1">//数据从文件流stream读到由ptr指向的数据缓冲区里。size参数指定每个数据记录的长度，计数器nitems给出要传输的记录个数</span>
<span class="kt">size_t</span> <span class="nf">fwrite</span><span class="p">(</span><span class="k">const</span> <span class="kt">void</span> <span class="o">*</span><span class="n">ptr</span><span class="p">,</span> <span class="kt">size_t</span> <span class="n">size</span><span class="p">,</span> <span class="kt">size_t</span> <span class="n">nitems</span><span class="p">,</span> <span class="kt">FILE</span> <span class="o">*</span><span class="n">stream</span><span class="p">);</span>
<span class="kt">int</span> <span class="nf">fclose</span><span class="p">(</span><span class="kt">FILE</span> <span class="o">*</span><span class="n">stream</span><span class="p">);</span>
<span class="kt">int</span> <span class="nf">fflush</span><span class="p">(</span><span class="kt">FILE</span> <span class="o">*</span><span class="n">stream</span><span class="p">);</span> <span class="c1">//把文件流里的所有未写出数据立刻写出。fclose函数隐含执行了一次flush操作，所以不必再调用fclose之前调用fflush</span>

<span class="kt">int</span> <span class="nf">fseek</span><span class="p">(</span><span class="kt">FILE</span> <span class="o">*</span><span class="n">stream</span><span class="p">,</span> <span class="kt">long</span> <span class="kt">int</span> <span class="n">offset</span><span class="p">,</span> <span class="kt">int</span> <span class="n">whence</span><span class="p">);</span> <span class="c1">//文件流里为下一次读写操作指定位置</span>

<span class="kt">int</span> <span class="nf">fgetc</span><span class="p">(</span><span class="kt">FILE</span> <span class="o">*</span><span class="n">stream</span><span class="p">);</span>
<span class="kt">int</span> <span class="nf">getc</span><span class="p">(</span><span class="kt">FILE</span> <span class="o">*</span><span class="n">stream</span><span class="p">);</span>
<span class="kt">int</span> <span class="nf">getchar</span><span class="p">();</span>      <span class="c1">//从标准输入里读取下一个字符</span>

<span class="kt">int</span> <span class="nf">fputc</span><span class="p">(</span><span class="kt">int</span> <span class="n">c</span><span class="p">,</span> <span class="kt">FILE</span> <span class="o">*</span><span class="n">stream</span><span class="p">);</span>
<span class="kt">int</span> <span class="nf">putc</span><span class="p">(</span><span class="kt">int</span> <span class="n">c</span><span class="p">,</span><span class="kt">FILE</span> <span class="o">*</span><span class="n">stream</span><span class="p">);</span>   <span class="c1">//但它可能被实现为一个宏</span>
<span class="kt">int</span> <span class="nf">putchar</span><span class="p">(</span><span class="kt">int</span> <span class="n">c</span><span class="p">);</span>

<span class="cm">/******</span>
<span class="cm">fgets把读到的字符写到s指向的字符串里，直到出现下面某种情况：遇到换行符，已经传输了n-1个字符，或者到达文件尾。</span>
<span class="cm">会把遇到的换行符也传递到接收字符串里，在加上一个表示结尾的空字节\0。一次调用最多只能传输n-1个字符，因为它必须要把空字节加上以结束字符串。</span>
<span class="cm">******/</span>
<span class="kt">char</span> <span class="o">*</span><span class="nf">fgets</span><span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="n">s</span><span class="p">,</span> <span class="kt">int</span> <span class="n">n</span><span class="p">,</span> <span class="kt">FILE</span> <span class="o">*</span><span class="n">stream</span><span class="p">);</span>
<span class="kt">char</span> <span class="o">*</span><span class="nf">gets</span><span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="n">s</span><span class="p">);</span>    <span class="c1">//它从标准输入读取数据并丢去遇到的换行符。它在接收字符串的尾部加上一个null字节。</span>
</pre></div>
</td></tr></table>

<h3 id="_3">格式化输入输出<a class="headerlink" href="#_3" title="Permanent link">&para;</a></h3>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kt">int</span> <span class="nf">printf</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">format</span><span class="p">,</span> <span class="p">...);</span>    <span class="c1">//输出送到标准输出</span>
<span class="kt">int</span> <span class="nf">sprintf</span><span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="n">s</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">format</span><span class="p">,</span> <span class="p">...);</span>  <span class="c1">//把输出和一个结尾空字符写到作为参数传递过来的字符串2里</span>
<span class="kt">int</span> <span class="nf">fprintf</span><span class="p">(</span><span class="kt">FILE</span> <span class="o">*</span><span class="n">stream</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">format</span><span class="p">,</span> <span class="p">...);</span> <span class="c1">//把输出送到一个指定的文件流。</span>

<span class="kt">int</span> <span class="nf">scanf</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">format</span><span class="p">,</span> <span class="p">...);</span>
<span class="kt">int</span> <span class="nf">fscanf</span><span class="p">(</span><span class="kt">FILE</span> <span class="o">*</span><span class="n">stream</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">format</span><span class="p">,</span> <span class="p">...);</span>
<span class="kt">int</span> <span class="nf">sscanf</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">s</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">format</span><span class="p">,</span> <span class="p">...);</span>

<span class="cm">/****</span>
<span class="cm">fgetpos: 获取文件流的当前位置。</span>
<span class="cm">fsetpos: 设置文件流的当前位置</span>
<span class="cm">ftell:  返回文件流当前位置的偏移</span>
<span class="cm">rewind: 重置文件流里的读写位置</span>
<span class="cm">freopen: 重新使用一个文件流</span>
<span class="cm">setvbuf: 设置文件流的缓冲机制</span>
<span class="cm">remove: 相当于unlink函数，如果参数path是一个目录，相当于rmdir函数</span>
<span class="cm">****/</span>

<span class="cp">#include</span><span class="cpf">&lt;errno.h&gt;</span><span class="cp"></span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">errno</span><span class="p">;</span>
<span class="kt">int</span> <span class="nf">ferror</span><span class="p">(</span><span class="kt">FILE</span> <span class="o">*</span><span class="n">stream</span><span class="p">);</span>
<span class="kt">int</span> <span class="nf">feof</span><span class="p">(</span><span class="kt">FILE</span> <span class="o">*</span><span class="n">stream</span><span class="p">);</span>
<span class="kt">void</span> <span class="nf">clearerr</span><span class="p">(</span><span class="kt">FILE</span> <span class="o">*</span><span class="n">stream</span><span class="p">);</span>

<span class="kt">int</span> <span class="nf">fileno</span><span class="p">(</span><span class="kt">FILE</span> <span class="o">*</span><span class="n">stream</span><span class="p">);</span>
<span class="kt">FILE</span> <span class="o">*</span><span class="nf">fdopen</span><span class="p">(</span><span class="kt">int</span> <span class="n">fildes</span><span class="p">,</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">mode</span><span class="p">);</span>
</pre></div>
</td></tr></table>

<h3 id="_4">文件和目录维护<a class="headerlink" href="#_4" title="Permanent link">&para;</a></h3>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="cp">#include</span><span class="cpf">&lt;sys/stat.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span><span class="cpf">&lt;unistd.h&gt;</span><span class="cp"></span>
<span class="kt">int</span> <span class="nf">chmod</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">path</span><span class="p">,</span> <span class="kt">mode_t</span> <span class="n">mode</span><span class="p">);</span>   <span class="c1">//改变文件目录的访问权限</span>
<span class="kt">int</span> <span class="nf">chown</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">path</span><span class="p">,</span> <span class="kt">uid_t</span> <span class="n">owner</span><span class="p">,</span> <span class="kt">gid_t</span> <span class="n">group</span><span class="p">);</span>

<span class="kt">int</span> <span class="nf">unlink</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">path</span><span class="p">);</span>
<span class="kt">int</span> <span class="nf">link</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">path1</span><span class="p">,</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">path2</span><span class="p">);</span>
<span class="kt">int</span> <span class="nf">symlink</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">path1</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">path2</span><span class="p">);</span>

<span class="kt">int</span> <span class="nf">mkdir</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">path</span><span class="p">,</span> <span class="kt">mode_t</span> <span class="n">mode</span><span class="p">);</span>
<span class="kt">int</span> <span class="nf">rmidr</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">path</span><span class="p">);</span>    <span class="c1">//删除空目录</span>

<span class="kt">char</span> <span class="o">*</span><span class="nf">getcwd</span><span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="n">buf</span><span class="p">,</span> <span class="kt">size_t</span> <span class="n">size</span><span class="p">);</span>   <span class="c1">//获取当前目录的名字</span>
<span class="kt">int</span> <span class="nf">chdir</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">path</span><span class="p">);</span>    
</pre></div>
</td></tr></table>

<h3 id="_5">扫描目录<a class="headerlink" href="#_5" title="Permanent link">&para;</a></h3>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5
6
7
8</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="cp">#include</span><span class="cpf">&lt;sys/types.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span><span class="cpf">&lt;dirent.h&gt;</span><span class="cp"></span>

<span class="kt">DIR</span> <span class="o">*</span><span class="nf">opendir</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">name</span><span class="p">);</span>
<span class="k">struct</span> <span class="n">dirent</span> <span class="o">*</span><span class="nf">readdir</span><span class="p">(</span><span class="kt">DIR</span> <span class="o">*</span><span class="n">dirp</span><span class="p">);</span>
<span class="kt">long</span> <span class="kt">int</span> <span class="nf">telldir</span><span class="p">(</span><span class="kt">DIR</span> <span class="o">*</span><span class="n">dirp</span><span class="p">);</span>
<span class="kt">void</span> <span class="nf">seekdir</span><span class="p">(</span><span class="kt">DIR</span> <span class="o">*</span><span class="n">dirp</span><span class="p">,</span> <span class="kt">long</span> <span class="kt">int</span> <span class="n">loc</span><span class="p">);</span>
<span class="kt">int</span> <span class="nf">closedir</span><span class="p">(</span><span class="kt">DIR</span> <span class="o">*</span><span class="n">dirp</span><span class="p">);</span>
</pre></div>
</td></tr></table>

<h3 id="_6">错误处理<a class="headerlink" href="#_6" title="Permanent link">&para;</a></h3>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="cp">#include</span><span class="cpf">&lt;string.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span><span class="cpf">&lt;stdio.h&gt;</span><span class="cp"></span>
<span class="kt">char</span> <span class="o">*</span><span class="nf">strerror</span><span class="p">(</span><span class="kt">int</span> <span class="n">errnum</span><span class="p">);</span>
<span class="kt">void</span> <span class="nf">perror</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">s</span><span class="p">);</span>
</pre></div>
</td></tr></table>

<h3 id="proc">/proc文件系统<a class="headerlink" href="#proc" title="Permanent link">&para;</a></h3>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="n">cat</span> <span class="o">/</span><span class="n">proc</span><span class="o">/</span><span class="n">cpuinfo</span>   <span class="c1">//查看cpu的详细信息</span>
<span class="n">cat</span> <span class="o">/</span><span class="n">proc</span><span class="o">/</span><span class="n">meminfo</span>   <span class="c1">//内存使用情况</span>
<span class="n">cat</span> <span class="o">/</span><span class="n">proc</span><span class="o">/</span><span class="n">version</span>   <span class="c1">//内核版本信息</span>
<span class="n">cat</span> <span class="o">/</span><span class="n">proc</span><span class="o">/</span><span class="n">sys</span><span class="o">/</span><span class="n">fs</span><span class="o">/</span><span class="n">file</span><span class="o">-</span><span class="n">max</span>   <span class="c1">//同时打开的文件总数</span>
</pre></div>
</td></tr></table>

<h3 id="fcntlmmap">fcntl和mmap<a class="headerlink" href="#fcntlmmap" title="Permanent link">&para;</a></h3>
<p><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kt">int</span> <span class="nf">fcntl</span><span class="p">(</span><span class="kt">int</span> <span class="n">fildes</span><span class="p">,</span> <span class="kt">int</span> <span class="n">cmd</span><span class="p">);</span>     <span class="c1">//对底层文件描述符提供更多的操作方法</span>
<span class="kt">int</span> <span class="nf">fcntl</span><span class="p">(</span><span class="kt">int</span> <span class="n">fildes</span><span class="p">,</span> <span class="kt">int</span> <span class="n">cmd</span><span class="p">,</span> <span class="kt">long</span> <span class="n">arg</span><span class="p">);</span>       
</pre></div>
</td></tr></table>
<strong>mmap</strong>(内存映射)函数的作用是建立一段可以被两个或更多个程序读写的内存。一个程序对它所做出的修改可以被其他程序看见。该函数创建一个指向一段内存区域的指针，该内存区域与可以通过一个打开的文件描述符访问的文件的内容相关联。
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5
6</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="cp">#include</span><span class="cpf">&lt;sys/mman.h&gt;</span><span class="cp"></span>
<span class="kt">void</span> <span class="o">*</span><span class="nf">mmap</span><span class="p">(</span><span class="kt">void</span> <span class="o">*</span><span class="n">addr</span><span class="p">,</span> <span class="kt">size_t</span> <span class="n">len</span><span class="p">,</span> <span class="kt">int</span> <span class="n">prot</span><span class="p">,</span> <span class="kt">int</span> <span class="n">flags</span><span class="p">,</span> <span class="kt">int</span> <span class="n">fildes</span><span class="p">,</span> <span class="kt">off_t</span> <span class="n">off</span><span class="p">);</span>

<span class="kt">int</span> <span class="nf">msync</span><span class="p">(</span><span class="kt">void</span> <span class="o">*</span><span class="n">addr</span><span class="p">,</span> <span class="kt">size_t</span> <span class="n">len</span><span class="p">,</span> <span class="kt">int</span> <span class="n">flags</span><span class="p">);</span>   <span class="c1">//把在该内存段的某个部分或整段中的修改写回到被映射的文件中</span>

<span class="kt">int</span> <span class="nf">munmap</span><span class="p">(</span><span class="kt">void</span> <span class="o">*</span><span class="n">addr</span><span class="p">,</span> <span class="kt">size_t</span> <span class="n">len</span><span class="p">);</span>     <span class="c1">//释放内存段</span>
</pre></div>
</td></tr></table></p>
<h2 id="linux">Linux环境<a class="headerlink" href="#linux" title="Permanent link">&para;</a></h2>
<p><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kt">int</span> <span class="n">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span><span class="n">argv</span><span class="p">[])</span>
<span class="c1">//argc是程序参数的个数(包括程序名本身)，argv是一个代表参数自身的字符串数组(程序名为第一个元素argv[0])。</span>
</pre></div>
</td></tr></table>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="cp">#include</span><span class="cpf">&lt;stdio.h&gt;</span><span class="cp"></span>
<span class="kt">int</span> <span class="nf">getopt</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span><span class="k">const</span> <span class="n">argv</span><span class="p">[],</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">optstring</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">char</span> <span class="o">*</span><span class="n">optarg</span><span class="p">;</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">optind</span><span class="p">,</span> <span class="n">opterr</span><span class="p">,</span> <span class="n">optopt</span><span class="p">;</span>
<span class="c1">//getopt_long</span>
</pre></div>
</td></tr></table></p>
<h3 id="_7">日志<a class="headerlink" href="#_7" title="Permanent link">&para;</a></h3>
<p><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">adm</span> <span class="o">&amp;</span> <span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">log</span>
<span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">log</span><span class="o">/</span><span class="n">messages</span>
<span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">log</span><span class="o">/</span><span class="n">mail</span>
<span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">syslog</span><span class="p">.</span><span class="n">conf</span>
<span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">syslog</span><span class="o">-</span><span class="n">ng</span><span class="o">/</span><span class="n">syslog</span><span class="o">-</span><span class="n">ng</span><span class="p">.</span><span class="n">conf</span>   <span class="c1">//检查系统配置</span>
</pre></div>
</td></tr></table>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5
6</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="cp">#include</span><span class="cpf">&lt;syslog.h&gt;</span><span class="cp"></span>
<span class="kt">void</span> <span class="nf">syslog</span><span class="p">(</span><span class="kt">int</span> <span class="n">priority</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">message</span><span class="p">,</span> <span class="n">arguments</span><span class="p">...);</span>
<span class="c1">//转换控制符%m用于插入与错误变量errno当前值对应的出错消息字符串</span>
<span class="kt">void</span> <span class="nf">closelog</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span>
<span class="kt">void</span> <span class="nf">openlog</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">ident</span><span class="p">,</span> <span class="kt">int</span> <span class="n">logopt</span><span class="p">,</span> <span class="kt">int</span> <span class="n">facility</span><span class="p">);</span>
<span class="kt">int</span> <span class="nf">setlogmask</span><span class="p">(</span><span class="kt">int</span> <span class="n">maskpri</span><span class="p">);</span>
</pre></div>
</td></tr></table></p>
<h2 id="_8">数据管理<a class="headerlink" href="#_8" title="Permanent link">&para;</a></h2>
<p>交换空间(swap space)</p>
<blockquote>
<p>按需换页的虚拟内存系统</p>
</blockquote>
<h3 id="_9">文件锁定<a class="headerlink" href="#_9" title="Permanent link">&para;</a></h3>
<p>文件段锁定(文件区域锁定)
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="cp">#include</span><span class="cpf">&lt;fcntl.h&gt;</span><span class="cp"></span>
<span class="kt">int</span> <span class="nf">fcntl</span><span class="p">(</span><span class="kt">int</span> <span class="n">fildes</span><span class="p">,</span> <span class="kt">int</span> <span class="n">command</span><span class="p">,</span> <span class="p">...);</span>
<span class="kt">int</span> <span class="nf">fcntl</span><span class="p">(</span><span class="kt">int</span> <span class="n">fildes</span><span class="p">,</span> <span class="kt">int</span> <span class="n">command</span><span class="p">,</span> <span class="k">struct</span> <span class="n">flock</span> <span class="o">*</span><span class="n">flock_structure</span><span class="p">);</span>
</pre></div>
</td></tr></table>
fcntl对一个打开的文件描述符进行操作，并根据command参数的设置完成不同的任务。提供了3个用于文件锁定的命令选项。
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="n">F_GETLK</span>
<span class="n">F_SETLK</span>
<span class="n">F_SETLKW</span>
</pre></div>
</td></tr></table>
flock(文件锁)结构依赖具体的实现，至少包含以下成员：
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kt">short</span> <span class="n">l_type</span>
<span class="kt">short</span> <span class="n">l_whence</span>  <span class="c1">//取值必须是SEEK_SET(文件头),SEEK_CUR(当前位置),SEEK_END(文件尾)中的一个。l_whence通常设置为SEEK_SET,这时l_start就从文件的开始计算</span>
<span class="kt">off_t</span> <span class="n">l_start</span>   <span class="c1">//l_whence是l_start的相对偏移位置，l_start是该区域的第一个字节</span>
<span class="kt">off_t</span> <span class="n">l_len</span>
<span class="kt">pid_t</span> <span class="n">l_pid</span>
</pre></div>
</td></tr></table>
l_type成员的取值定义在头文件fcntl.h中
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="n">F_RDLCK</span>     <span class="c1">//共享(或读)锁。许多不同的进程可以拥有文件同一(或者重叠)区域上的共享锁。只要任一进程拥有一把共享锁，那么就没有进程可以再获得该区域上的独占锁。为了获得一把共享锁，文件必须以“读”或“读写”方式打开</span>
<span class="n">F_UNLCK</span>     <span class="c1">//解锁，用来清除锁</span>
<span class="n">F_WRLCK</span>     <span class="c1">//独占(或写)锁。只有一个进程可以在文件的任一特定区域拥有一把独占锁。一旦一个进程拥有了这样一把锁，任何其他进程都无法在该区域上获得任何类型的锁。为了获得一把独占锁，文件必须以“写”或“读/写”方式打开</span>
</pre></div>
</td></tr></table>
<strong>F_GETLK命令</strong>
用于获取fildes打开的文件的锁信息。它不会尝试去锁定文件。</p>
<p>调用进程把自己想创建的锁类型信息传递给fcntl，使用F_GETLK命令的fcntl就会返回将会阻止获取锁的任何信息。</p>
<p>进程可能使用F_GETLK调用来查看文件中某个区域的当前锁状态。如果文件已被锁定从而阻止锁请求成功执行，fcntl会用相关信息覆盖flock结构。如果所请求可以成功执行，flock结构将保持不变，如果F_GETLK调用无法获得信息，它将返回-1表明失败。成功就返回非-1值。</p>
<p><strong>F_SETLK命令</strong>
对fildes指向的文件的某个区域加锁或解锁。flock结构中使用的值:l_type,l_pid。与F_GETLK一样，要加锁的区域由flock结构中的l_start,l_whence和l_len的值定义。</p>
<p>如果锁成功，返回非-1值，失败返回-1。</p>
<p><strong>F_SETLKW命令</strong>
与F_SETLK相同，但在无法获取锁时，这个调用将等待直到可以为止。一旦开始等待，只有在可以获取锁或收到一个信号时才会返回。</p>
<h2 id="mysql">MySQL<a class="headerlink" href="#mysql" title="Permanent link">&para;</a></h2>
<h3 id="_10">连接<a class="headerlink" href="#_10" title="Permanent link">&para;</a></h3>
<ol>
<li>初始化一个连接句柄结构</li>
<li>实际进行连接
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="cp">#include</span><span class="cpf">&lt;mysql.h&gt;</span><span class="cp"></span>
<span class="n">MYSQL</span> <span class="o">*</span><span class="nf">mysql_init</span><span class="p">(</span><span class="n">MYSQL</span> <span class="o">*</span><span class="p">);</span>
<span class="n">MYSQL</span> <span class="o">*</span><span class="nf">mysql_real_connect</span><span class="p">(</span><span class="n">MYSQL</span> <span class="o">*</span><span class="n">connection</span><span class="p">,</span>    <span class="c1">//被mysql_init初始化的结构</span>
        <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">server_host</span><span class="p">,</span>        <span class="c1">//可以是主机名也可以是ip地址</span>
        <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">sql_user_name</span><span class="p">,</span>
        <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">sql_password</span><span class="p">,</span>
        <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">db_name</span><span class="p">,</span>
        <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">port_number</span><span class="p">,</span>       <span class="c1">//0</span>
        <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">unix_socket_name</span><span class="p">,</span>   <span class="c1">//NULL</span>
        <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">flags</span><span class="p">);</span>
<span class="kt">void</span> <span class="nf">mysql_close</span><span class="p">(</span><span class="n">MYSQL</span> <span class="o">*</span><span class="n">connection</span><span class="p">);</span>
</pre></div>
</td></tr></table>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5
6
7
8</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kt">int</span> <span class="nf">mysql_options</span><span class="p">(</span><span class="n">MYSQL</span> <span class="o">*</span><span class="n">connection</span><span class="p">,</span> <span class="k">enum</span> <span class="n">option_to_set</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">argument</span><span class="p">);</span>
<span class="cm">/******</span>
<span class="cm">1. 在mysql_init和mysql_real_connect之间即可。</span>
<span class="cm">2. MYSQL_OPT_CONNECT_TIMEOUT const unsigned int * 连接超时之前的等待秒速</span>
<span class="cm">3. MYSQL_OPT_COMPRESS None,使用NULL 网络连接中使用压缩机制</span>
<span class="cm">4. MYSQL_INIT_COMMAND const char * 每次建立后发送的命令</span>
<span class="cm">5. 成功的调用将返回0。</span>
<span class="cm">******/</span>
</pre></div>
</td></tr></table></li>
</ol>
<h3 id="_11">错误处理<a class="headerlink" href="#_11" title="Permanent link">&para;</a></h3>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kt">unsigned</span> <span class="kt">int</span> <span class="nf">mysql_errno</span><span class="p">(</span><span class="n">MYSQL</span> <span class="o">*</span><span class="n">connection</span><span class="p">);</span>
<span class="kt">char</span> <span class="o">*</span><span class="nf">mysql_error</span><span class="p">(</span><span class="n">MYSQL</span> <span class="o">*</span><span class="n">connection</span><span class="p">);</span>
</pre></div>
</td></tr></table>

<h3 id="_12">执行<a class="headerlink" href="#_12" title="Permanent link">&para;</a></h3>
<h4 id="updatedeleteinsert">不返回数据的语句UPDATE,DELETE,INSERT<a class="headerlink" href="#updatedeleteinsert" title="Permanent link">&para;</a></h4>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="n">my_ulonglong</span> <span class="nf">mysql_affected_rows</span><span class="p">(</span><span class="n">MYSQL</span> <span class="o">*</span><span class="n">connection</span><span class="p">);</span>    <span class="c1">//用于检查受影响的行数</span>
</pre></div>
</td></tr></table>

<h4 id="_13">返回数据的语句<a class="headerlink" href="#_13" title="Permanent link">&para;</a></h4>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="n">MYSQL_RES</span> <span class="o">*</span><span class="nf">mysql_store_result</span><span class="p">(</span><span class="n">MYSQL</span> <span class="o">*</span><span class="n">connection</span><span class="p">);</span>   <span class="c1">//提取所有的数据</span>
<span class="n">my_ulonglong</span> <span class="nf">mysql_num_rows</span><span class="p">(</span><span class="n">MYSQL_RES</span> <span class="o">*</span><span class="n">result</span><span class="p">);</span>     <span class="c1">//返回结果集中的行数</span>
<span class="n">MYSQL_ROW</span> <span class="nf">mysql_fetch_row</span><span class="p">(</span><span class="n">MYSQL_RES</span> <span class="o">*</span><span class="n">result</span><span class="p">);</span>       <span class="c1">//从mysql_store_result的结果中提取一行，放入一个行结构中</span>
<span class="kt">void</span> <span class="nf">mysql_data_seek</span><span class="p">(</span><span class="n">MYSQL_RES</span> <span class="o">*</span><span class="n">result</span><span class="p">,</span> <span class="n">myulonglong</span> <span class="n">offset</span><span class="p">);</span>    <span class="c1">//在结果集中跳转，设置被下一个mysql_fetch_row操作的返回的行</span>
<span class="n">MYSQL_ROW_OFFSET</span> <span class="nf">mysql_row_tell</span><span class="p">(</span><span class="n">MYSQL_RES</span> <span class="o">*</span><span class="n">result</span><span class="p">);</span>     <span class="c1">//返回一个偏移值，表示结果集中的当前位置</span>
<span class="n">MYSQL_ROW_OFFSET</span> <span class="nf">mysql_row_seek</span><span class="p">(</span><span class="n">MYSQL_RES</span> <span class="o">*</span><span class="n">result</span><span class="p">,</span> <span class="n">MYSQL_ROW_OFFSET</span> <span class="n">offset</span><span class="p">);</span>        <span class="c1">//在结果集中移动当前位置，返回之前位置</span>
<span class="kt">void</span> <span class="nf">mysql_free_result</span><span class="p">(</span><span class="n">MYSQL_RES</span> <span class="o">*</span><span class="n">result</span><span class="p">);</span>
<span class="n">MYSQL_RES</span> <span class="o">*</span><span class="nf">mysql_use_result</span><span class="p">(</span><span class="n">MYSQL</span> <span class="o">*</span><span class="n">connection</span><span class="p">);</span> <span class="c1">//逐行提取数据，未提取的数据网络中</span>
<span class="kt">unsigned</span> <span class="kt">int</span> <span class="nf">mysql_field_count</span><span class="p">(</span><span class="n">MYSQL</span> <span class="o">*</span><span class="n">connection</span><span class="p">);</span>
<span class="n">MYSQL_FIELD</span> <span class="o">*</span><span class="nf">mysql_fetch_field</span><span class="p">(</span><span class="n">MYSQL_RES</span> <span class="o">*</span><span class="n">result</span><span class="p">);</span>
</pre></div>
</td></tr></table>

<h2 id="_14">开发工具<a class="headerlink" href="#_14" title="Permanent link">&para;</a></h2>
<h3 id="make">make<a class="headerlink" href="#make" title="Permanent link">&para;</a></h3>
<h3 id="makefile">makefile<a class="headerlink" href="#makefile" title="Permanent link">&para;</a></h3>
<h3 id="_15">后缀和模式规则<a class="headerlink" href="#_15" title="Permanent link">&para;</a></h3>
<h3 id="makefile_1">makefile文件和子目录<a class="headerlink" href="#makefile_1" title="Permanent link">&para;</a></h3>
<h2 id="_16">调试<a class="headerlink" href="#_16" title="Permanent link">&para;</a></h2>
<h3 id="_17">预处理&amp;宏<a class="headerlink" href="#_17" title="Permanent link">&para;</a></h3>
<h3 id="gdb">GDB调试<a class="headerlink" href="#gdb" title="Permanent link">&para;</a></h3>
<h2 id="_18">进程与信号<a class="headerlink" href="#_18" title="Permanent link">&para;</a></h2>
<p>UNIX标准定义进程为：一个其中运行着一个或多个线程的地址空间和这些线程所需要的系统资源。
<strong>启动新进程</strong>
它必须用一个shell来启动程序，使用system函数的效率不高。
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="cp">#include</span><span class="cpf">&lt;stdlib.h&gt;</span><span class="cp"></span>
<span class="kt">int</span> <span class="nf">system</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">string</span><span class="p">);</span>
</pre></div>
</td></tr></table></p>
<h3 id="exec">替换进程映像exec系列函数<a class="headerlink" href="#exec" title="Permanent link">&para;</a></h3>
<p>exec系列函数把当前进程替换为一个新进程。可以使用exec函数讲程序的执行从一个程序切换到另一个程序。exec函数比system函数更有效，新的程序启动后，原来的程序不再运行。
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5
6
7
8</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="cp">#include</span><span class="cpf">&lt;stdio.h&gt;</span><span class="cp"></span>
<span class="kt">char</span> <span class="o">**</span><span class="n">environ</span><span class="p">;</span>
<span class="kt">int</span> <span class="nf">execl</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">path</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">arg0</span><span class="p">,</span> <span class="p">...,</span> <span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="p">)</span><span class="mi">0</span><span class="p">);</span>
<span class="kt">int</span> <span class="nf">execlp</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">file</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">arg0</span><span class="p">,</span> <span class="p">...,</span> <span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="p">)</span><span class="mi">0</span><span class="p">);</span>
<span class="kt">int</span> <span class="nf">execle</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">path</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">arg0</span><span class="p">,</span> <span class="p">...,</span> <span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="p">)</span><span class="mi">0</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span><span class="k">const</span> <span class="n">envp</span><span class="p">[]);</span>
<span class="kt">int</span> <span class="nf">execv</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">path</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span><span class="k">const</span> <span class="n">argv</span><span class="p">[]);</span>
<span class="kt">int</span> <span class="nf">execvp</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">file</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span><span class="k">const</span> <span class="n">argv</span><span class="p">[]);</span>
<span class="kt">int</span> <span class="nf">execve</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">path</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span><span class="k">const</span> <span class="n">argv</span><span class="p">[],</span> <span class="kt">char</span> <span class="o">*</span><span class="k">const</span> <span class="n">envp</span><span class="p">[]);</span>
</pre></div>
</td></tr></table></p>
<h3 id="fork">复制进程映像fork<a class="headerlink" href="#fork" title="Permanent link">&para;</a></h3>
<p><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="cp">#include</span><span class="cpf">&lt;sys/types.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span><span class="cpf">&lt;unistd.h&gt;</span><span class="cp"></span>
<span class="kt">pid_t</span> <span class="nf">fork</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span>
<span class="kt">pid_t</span> <span class="n">new_pid</span><span class="p">;</span>
<span class="n">new_pid</span> <span class="o">=</span> <span class="n">fork</span><span class="p">();</span>
<span class="k">switch</span><span class="p">(</span><span class="n">new_pid</span><span class="p">)</span>
<span class="p">{</span>
        <span class="k">case</span> <span class="o">-</span><span class="mi">1</span><span class="o">:</span>        <span class="c1">//error</span>
                <span class="k">break</span><span class="p">;</span>
        <span class="k">case</span> <span class="mi">0</span><span class="o">:</span>         <span class="c1">//child</span>
                <span class="k">break</span><span class="p">;</span>
        <span class="k">default</span> <span class="o">:</span>       <span class="c1">//parent</span>
                <span class="k">break</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>
<strong>wait等待一个进程</strong>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="cp">#include</span><span class="cpf">&lt;sys/types.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span><span class="cpf">&lt;sys/wait.h&gt;</span><span class="cp"></span>
<span class="kt">pid_t</span> <span class="nf">wait</span><span class="p">(</span><span class="kt">int</span> <span class="o">*</span><span class="n">stat_loc</span><span class="p">);</span>
<span class="kt">pid_t</span> <span class="nf">waitpid</span><span class="p">(</span><span class="kt">pid_t</span> <span class="n">pid</span><span class="p">,</span> <span class="kt">int</span> <span class="o">*</span><span class="n">stat_loc</span><span class="p">,</span> <span class="kt">int</span> <span class="n">options</span><span class="p">);</span>
<span class="cm">/*pid参数如果为-1，waitpid将返回任一子进程信息。*/</span>
</pre></div>
</td></tr></table>
<strong>僵尸进程</strong></p>
<p>子进程终止时，与父进程之间的关联还会保持，直到父进程也正常终止或父进程调用wait才结束。代表子进程的表项不会立刻释放，仍然存在于系统中，它的退出码仍然保存，此时它成为一个僵尸进程。</p>
<h3 id="_19">信号<a class="headerlink" href="#_19" title="Permanent link">&para;</a></h3>
<p>信号是unix和linux系统响应某些条件而产生的一个事件。</p>
<p><strong>处理信号</strong>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="cp">#include</span><span class="cpf">&lt;stdio.h&gt;</span><span class="cp"></span>
<span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">signal</span><span class="p">(</span><span class="kt">int</span> <span class="n">sig</span><span class="p">,</span> <span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">func</span><span class="p">)(</span><span class="kt">int</span><span class="p">)))(</span><span class="kt">int</span><span class="p">);</span>
</pre></div>
</td></tr></table></p>
<p><strong>发送信号</strong>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5
6
7
8</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="cp">#include</span><span class="cpf">&lt;sys/types.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span><span class="cpf">&lt;signal.h&gt;</span><span class="cp"></span>
<span class="kt">int</span> <span class="nf">kill</span><span class="p">(</span><span class="kt">pid_t</span> <span class="n">pid</span><span class="p">,</span> <span class="kt">int</span> <span class="n">sig</span><span class="p">);</span>   <span class="c1">//成功0，失败-1</span>

<span class="cp">#include</span><span class="cpf">&lt;unistd.h&gt;</span><span class="cp"></span>
<span class="kt">unsigned</span> <span class="kt">int</span> <span class="nf">alarm</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">seconds</span><span class="p">);</span> <span class="c1">//定时发送SIGALRM信号</span>

<span class="kt">int</span> <span class="nf">pause</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span>        <span class="c1">//把程序挂起直到一个信号出现为止</span>
</pre></div>
</td></tr></table></p>
<p><strong>一个健壮的信号接口</strong>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="cp">#include</span><span class="cpf">&lt;signal.h&gt;</span><span class="cp"></span>
<span class="kt">int</span> <span class="nf">sigaction</span><span class="p">(</span><span class="kt">int</span> <span class="n">sig</span><span class="p">,</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">sigaction</span> <span class="o">*</span><span class="n">act</span><span class="p">,</span> <span class="k">struct</span> <span class="n">sigaction</span> <span class="o">*</span><span class="n">oact</span><span class="p">);</span>
</pre></div>
</td></tr></table>
sigaction结构成员
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="p">)</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span> <span class="n">sa_handler</span>       <span class="c1">//函数指针，指向接收到信号sig时将被调用的信号处理函数。可以设置为SIG_IGN和SIG_DFL,分别表示忽略和恢复</span>
<span class="kt">sigset_t</span> <span class="n">sa_mask</span>                <span class="c1">//信号集,加入到进程的信号屏蔽字段的</span>
<span class="kt">int</span> <span class="n">sa_flags</span>                    <span class="c1">//</span>
</pre></div>
</td></tr></table>
<strong>信号集</strong>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="cp">#include</span><span class="cpf">&lt;signal.h&gt;</span><span class="cp"></span>

<span class="kt">int</span> <span class="nf">sigaddset</span><span class="p">(</span><span class="kt">sigset_t</span> <span class="o">*</span><span class="n">set</span><span class="p">,</span> <span class="kt">int</span> <span class="n">signo</span><span class="p">);</span>        <span class="c1">//增加给定的信号</span>
<span class="kt">int</span> <span class="nf">sigemptyset</span><span class="p">(</span><span class="kt">sigset_t</span> <span class="o">*</span><span class="n">set</span><span class="p">);</span>         <span class="c1">//将信号集初始化为空</span>
<span class="kt">int</span> <span class="nf">sigfillset</span><span class="p">(</span><span class="kt">sigset_t</span> <span class="o">*</span><span class="n">set</span><span class="p">);</span>          <span class="c1">//将信号集初始化为包含所有已定义的信号</span>
<span class="kt">int</span> <span class="nf">sigdelset</span><span class="p">(</span><span class="kt">sigset_t</span> <span class="o">*</span><span class="n">set</span><span class="p">,</span> <span class="kt">int</span> <span class="n">signo</span><span class="p">);</span>        <span class="c1">//删除给定的信号</span>
<span class="kt">int</span> <span class="nf">sigismember</span><span class="p">(</span><span class="kt">sigset_t</span> <span class="o">*</span><span class="n">set</span><span class="p">,</span> <span class="kt">int</span> <span class="n">signo</span><span class="p">);</span>      <span class="c1">//判断一个给定的信号是否是一个信号集的成员</span>
<span class="kt">int</span> <span class="nf">sigprocmask</span><span class="p">(</span><span class="kt">int</span> <span class="n">how</span><span class="p">,</span> <span class="k">const</span> <span class="kt">sigset_t</span> <span class="o">*</span><span class="n">set</span><span class="p">,</span> <span class="kt">sigset_t</span> <span class="o">*</span><span class="n">oset</span><span class="p">);</span>
<span class="kt">int</span> <span class="nf">sigpending</span><span class="p">(</span><span class="kt">sigset_t</span> <span class="o">*</span><span class="n">set</span><span class="p">);</span>
<span class="kt">int</span> <span class="nf">sigsuspend</span><span class="p">(</span><span class="k">const</span> <span class="kt">sigset_t</span> <span class="o">*</span><span class="n">sigmask</span><span class="p">);</span>
</pre></div>
</td></tr></table></p>
<h2 id="posix">POSIX线程<a class="headerlink" href="#posix" title="Permanent link">&para;</a></h2>
<p>线程是一个进程内部的一个控制序列。</p>
<p>当进程执行fork调用时，将创建出该进程的一个新副本。这个新进程拥有自己的变量和自己的PID，它的时间调度也是独立的，它的执行几乎完全独立于父进程。</p>
<p>当进程中创建一个新线程时，新的执行线程将拥有自己的栈(因此也有自己的局部变量),但与它的创建者共享全局变量、文件描述符、信号处理函数和当前的目录状态。</p>
<p><strong>_PEENTRANT</strong>宏定义来告诉编译器我们需要可重入功能。</p>
<p><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="cp">#include</span><span class="cpf">&lt;pthread.h&gt;</span><span class="cp"></span>

<span class="kt">int</span> <span class="nf">pthread_create</span><span class="p">(</span><span class="n">pthread_t</span> <span class="o">*</span><span class="kr">thread</span><span class="p">,</span> <span class="n">pthread_attr_t</span> <span class="o">*</span><span class="n">attr</span><span class="p">,</span> <span class="kt">void</span> <span class="o">*</span><span class="p">(</span><span class="o">*</span><span class="n">start_routine</span><span class="p">)(</span><span class="kt">void</span> <span class="o">*</span><span class="p">),</span> <span class="kt">void</span> <span class="o">*</span><span class="n">arg</span><span class="p">);</span>
</pre></div>
</td></tr></table>
1. 第一个参数写入一个标识符来引用新线程
2. 第二个参数设置线程属性，一般不需要时设置为NULL
3. 第三个参数启动线程将要执行的函数
4. 第四个参数传递给执行函数的参数
成功返回0，失败返回错误代码。</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="cp">#include</span><span class="cpf">&lt;pthread.h&gt;</span><span class="cp"></span>
<span class="kt">void</span> <span class="nf">pthread_exit</span><span class="p">(</span><span class="kt">void</span> <span class="o">*</span><span class="n">retval</span><span class="p">);</span>        <span class="c1">//终止调用它的线程</span>

<span class="kt">int</span> <span class="nf">pthread_join</span><span class="p">(</span><span class="n">pthread_t</span> <span class="n">th</span><span class="p">,</span> <span class="kt">void</span> <span class="o">**</span><span class="n">thread_return</span><span class="p">);</span>   <span class="c1">//第二个参数执行一个指针，它指向另一个指针，而后者指向线程的返回值。</span>
</pre></div>
</td></tr></table>

<p>检查头文件/usr/include/pthread.h。如果这个文件中显示的版权日期是2003年或更晚，那几乎可以肯定使用的是NPTL实现。
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="n">gcc</span> <span class="o">-</span><span class="n">D_REENTRANT</span> <span class="o">-</span><span class="n">I</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">include</span><span class="o">/</span><span class="n">nptl</span> <span class="n">thread1</span><span class="p">.</span><span class="n">c</span> <span class="o">-</span><span class="n">o</span> <span class="n">thread1</span> <span class="o">-</span><span class="n">L</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">nptl</span> <span class="o">-</span><span class="n">lpthread</span>

<span class="c1">//如果系统默认使用NPTL线程库，那么编译程序就无需加上-I和-L选项。</span>
<span class="n">gcc</span> <span class="o">-</span><span class="n">D_REENTRANT</span> <span class="n">thread1</span><span class="p">.</span><span class="n">c</span> <span class="o">-</span><span class="n">o</span> <span class="n">thread1</span> <span class="o">-</span><span class="n">lpthread</span>
</pre></div>
</td></tr></table></p>
<h3 id="_20">同步<a class="headerlink" href="#_20" title="Permanent link">&para;</a></h3>
<h4 id="_21">信号量<a class="headerlink" href="#_21" title="Permanent link">&para;</a></h4>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5
6
7
8</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="cp">#include</span><span class="cpf">&lt;semaphore.h&gt;</span><span class="cp"></span>

<span class="kt">int</span> <span class="nf">sem_init</span><span class="p">(</span><span class="n">sem_t</span> <span class="o">*</span><span class="n">sem</span><span class="p">,</span> <span class="kt">int</span> <span class="n">pshared</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">value</span><span class="p">);</span>      <span class="c1">//pshared参数控制信号量的类型，如果为0，表示这个信号量是当前进程的局部信号量，否则，这个信号量就可以在多个进程之间共享。</span>

<span class="c1">//该指针指向的对象是sem_init调用初始化的信号量</span>
<span class="kt">int</span> <span class="nf">sem_wait</span><span class="p">(</span><span class="n">sem_t</span> <span class="o">*</span><span class="n">sem</span><span class="p">);</span>       <span class="c1">//减1，它会等待信号量有个非零值才会开始减法操作。如果对值为0的信号量调用sem_wait，这个函数就会等待。</span>
<span class="kt">int</span> <span class="nf">sem_post</span><span class="p">(</span><span class="n">sem_t</span> <span class="o">*</span><span class="n">sem</span><span class="p">);</span>       <span class="c1">//以原子操作的方式给信号量的值加1。</span>
<span class="kt">int</span> <span class="nf">sem_destroy</span><span class="p">(</span><span class="n">sem_t</span> <span class="o">*</span><span class="n">sem</span><span class="p">);</span>
</pre></div>
</td></tr></table>

<h4 id="_22">互斥量<a class="headerlink" href="#_22" title="Permanent link">&para;</a></h4>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="cp">#include</span><span class="cpf">&lt;pthread.h&gt;</span><span class="cp"></span>

<span class="kt">int</span> <span class="nf">pthread_mutex_init</span><span class="p">(</span><span class="n">pthread_mutex_t</span> <span class="o">*</span><span class="n">mutex</span><span class="p">,</span> <span class="k">const</span> <span class="n">pthread_mutexattr_t</span> <span class="o">*</span><span class="n">mutexattr</span><span class="p">);</span>

<span class="kt">int</span> <span class="nf">pthread_mutex_lock</span><span class="p">(</span><span class="n">pthread_mutex_t</span> <span class="o">*</span><span class="n">mutex</span><span class="p">);</span>

<span class="kt">int</span> <span class="nf">pthread_mutex_unlock</span><span class="p">(</span><span class="n">pthread_mutex_t</span> <span class="o">*</span><span class="n">mutex</span><span class="p">);</span>

<span class="kt">int</span> <span class="nf">pthread_mutex_destroy</span><span class="p">(</span><span class="n">pthread_mutex_t</span> <span class="o">*</span><span class="n">mutex</span><span class="p">);</span>

<span class="c1">//成功时返回0，失败时返回错误代码。</span>
</pre></div>
</td></tr></table>

<h3 id="_23">线程属性<a class="headerlink" href="#_23" title="Permanent link">&para;</a></h3>
<p><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="cp">#include</span><span class="cpf">&lt;pthread.h&gt;</span><span class="cp"></span>
<span class="kt">int</span> <span class="nf">pthread_attr_init</span><span class="p">(</span><span class="n">pthread_attr_t</span> <span class="o">*</span><span class="n">attr</span><span class="p">);</span>
</pre></div>
</td></tr></table>
<strong>线程调度</strong></p>
<p><strong>取消线程</strong></p>
<p><strong>多线程</strong></p>
<h2 id="_24">进程间通信：管道<a class="headerlink" href="#_24" title="Permanent link">&para;</a></h2>
<h3 id="_25">进程管道<a class="headerlink" href="#_25" title="Permanent link">&para;</a></h3>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="cp">#include</span><span class="cpf">&lt;stdio.h&gt;</span><span class="cp"></span>
<span class="kt">FILE</span> <span class="o">*</span><span class="nf">popen</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">command</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">open_mode</span><span class="p">);</span>
<span class="kt">int</span> <span class="nf">pclose</span><span class="p">(</span><span class="kt">FILE</span> <span class="o">*</span><span class="n">stream_to_close</span><span class="p">);</span>
<span class="c1">//调用popen函数返回FILE*文件指针流，之后就可以通过fread与fwrite函数来处理流</span>
</pre></div>
</td></tr></table>

<h3 id="pipe">底层的pipe函数<a class="headerlink" href="#pipe" title="Permanent link">&para;</a></h3>
<p>这个函数在两个程序之间传递数据不需要启动一个shell来解释请求命令
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="cp">#include</span><span class="cpf">&lt;unistd.h&gt;</span><span class="cp"></span>
<span class="kt">int</span> <span class="nf">pipe</span><span class="p">(</span><span class="kt">int</span> <span class="n">file_descriptor</span><span class="p">[</span><span class="mi">2</span><span class="p">]);</span>
<span class="c1">//pipe函数的参数是一个由两个整数类型的文件描述符组成的整组的指针。</span>
</pre></div>
</td></tr></table>
写入file_descriptor[1]的所有数据都可以从file_descriptor[0]读回来。</p>
<p>pipe使用的是文件描述符不是文件流，所有必须使用底层的read和write调用来访问数据。</p>
<h3 id="_26">命名管道(不先关的进程之间)<a class="headerlink" href="#_26" title="Permanent link">&para;</a></h3>
<p>命令行上创建命名管道
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="n">mknod</span> <span class="n">filename</span> <span class="n">p</span>
<span class="n">mkfifo</span> <span class="n">filename</span>
</pre></div>
</td></tr></table>
程序中
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="cp">#include</span><span class="cpf">&lt;sys/types.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span><span class="cpf">&lt;sys/stat.h&gt;</span><span class="cp"></span>

<span class="kt">int</span> <span class="nf">mkfifo</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">filename</span><span class="p">,</span> <span class="kt">mode_t</span> <span class="n">mode</span><span class="p">);</span>
<span class="kt">int</span> <span class="nf">mknod</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">filename</span><span class="p">,</span> <span class="kt">mode_t</span> <span class="n">mode</span> <span class="o">|</span> <span class="n">S_IFIFO</span><span class="p">,</span> <span class="p">(</span><span class="kt">dev_t</span><span class="p">)</span> <span class="mi">0</span><span class="p">);</span>

<span class="cm">/*open调用将阻塞，除非有一个进程以写方式打开同一个FIFO，否则不会返回。*/</span>
<span class="n">open</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">path</span><span class="p">,</span> <span class="n">O_RDONLY</span><span class="p">);</span> 

<span class="cm">/*即使没有其他进程以写方式打开FIFO，这个open调用也将成功并立刻返回。*/</span>
<span class="n">open</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">path</span><span class="p">,</span> <span class="n">O_RDONLY</span><span class="o">|</span><span class="n">O_NONBLOCK</span><span class="p">);</span>

<span class="cm">/*open调用将阻塞，直到有一个进程以读方式打开同一个FIFO为止*/</span>
<span class="n">open</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">path</span><span class="p">,</span> <span class="n">O_WRONLY</span><span class="p">);</span>

<span class="cm">/*立刻返回*/</span>
<span class="n">open</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">path</span><span class="p">,</span> <span class="n">O_WRONLY</span><span class="o">|</span><span class="n">O_NONBLOCK</span><span class="p">);</span>
</pre></div>
</td></tr></table></p>
<h2 id="_27">信号量、共享内存和消息队列<a class="headerlink" href="#_27" title="Permanent link">&para;</a></h2>
<h3 id="_28">信号量<a class="headerlink" href="#_28" title="Permanent link">&para;</a></h3>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="cp">#include</span><span class="cpf">&lt;sys/sem.h&gt;</span><span class="cp"></span>

<span class="cm">/*直接控制信号量信息*/</span>
<span class="kt">int</span> <span class="nf">semctl</span><span class="p">(</span><span class="kt">int</span> <span class="n">sem_id</span><span class="p">,</span> <span class="kt">int</span> <span class="n">sem_num</span><span class="p">,</span> <span class="kt">int</span> <span class="n">command</span><span class="p">,</span> <span class="p">...);</span>
<span class="k">union</span> <span class="n">semun</span><span class="p">{</span>
        <span class="kt">int</span> <span class="n">val</span><span class="p">;</span>
        <span class="k">struct</span> <span class="n">semid_ds</span> <span class="o">*</span><span class="n">buf</span><span class="p">;</span>
        <span class="kt">unsigned</span> <span class="kt">short</span> <span class="o">*</span><span class="n">array</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/*创建一个新的信号量或取得一个已有信号量的键</span>
<span class="cm">num_sems参数指定需要的信号量数目，它几乎总是取值为1</span>
<span class="cm">成功时返回一个正数即其他信号量函数将用到的信号量标识符，失败返回-1*/</span>
<span class="kt">int</span> <span class="n">semget</span><span class="p">(</span><span class="kt">key_t</span> <span class="n">key</span><span class="p">,</span> <span class="kt">int</span> <span class="n">num_sems</span><span class="p">,</span> <span class="kt">int</span> <span class="n">sem_flags</span><span class="p">);</span>

<span class="cm">/*用于改变信号量的值*/</span>
<span class="kt">int</span> <span class="nf">semop</span><span class="p">(</span><span class="kt">int</span> <span class="n">sem_id</span><span class="p">,</span> <span class="k">struct</span> <span class="n">sembuf</span> <span class="o">*</span><span class="n">sem_ops</span><span class="p">,</span> <span class="kt">size_t</span> <span class="n">num_sem_ops</span><span class="p">);</span>
<span class="k">struct</span> <span class="n">sembuf</span><span class="p">{</span>
        <span class="kt">short</span> <span class="n">sem_num</span><span class="p">;</span>
        <span class="kt">short</span> <span class="n">sem_op</span><span class="p">;</span>
        <span class="kt">short</span> <span class="n">sem_flg</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>

<h3 id="_29">共享内存<a class="headerlink" href="#_29" title="Permanent link">&para;</a></h3>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="cp">#include</span><span class="cpf">&lt;sys/shm.h&gt;</span><span class="cp"></span>

<span class="cm">/*刚创建共享内存时，不能被任何进程访问，shmat函数启用对该共享内存的访问，将其连接到一个进程的地址空间中。</span>
<span class="cm">第二个参数shm_addr指定共享内存连接到当前进程中的地址位置，一般是空指针，表示让系统来选择共享内存出现的地址。*/</span>
<span class="kt">void</span> <span class="o">*</span><span class="nf">shmat</span><span class="p">(</span><span class="kt">int</span> <span class="n">shm_id</span><span class="p">,</span> <span class="k">const</span> <span class="kt">void</span> <span class="o">*</span><span class="n">shm_addr</span><span class="p">,</span> <span class="kt">int</span> <span class="n">shmflg</span><span class="p">);</span>

<span class="cm">/**/</span>
<span class="kt">int</span> <span class="nf">shmctl</span><span class="p">(</span><span class="kt">int</span> <span class="n">shm_id</span><span class="p">,</span> <span class="kt">int</span> <span class="n">cmd</span><span class="p">,</span> <span class="k">struct</span> <span class="n">shmid_ds</span> <span class="o">*</span><span class="n">buf</span><span class="p">);</span>
<span class="k">struct</span> <span class="n">shmid_ds</span><span class="p">{</span>
        <span class="kt">uid_t</span> <span class="n">shm_perm</span><span class="p">.</span><span class="n">uid</span><span class="p">;</span>
        <span class="kt">uid_t</span> <span class="n">shm_perm</span><span class="p">.</span><span class="n">gid</span><span class="p">;</span>
        <span class="kt">mode_t</span> <span class="n">shm_perm</span><span class="p">.</span><span class="n">mode</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/*将共享内存从当前进程中分离。</span>
<span class="cm">成功返回0，失败返回-1。</span>
<span class="cm">分离并未删除，只是使得该共享内存对当前进程不再可用*/</span>
<span class="kt">int</span> <span class="n">shmdt</span><span class="p">(</span><span class="k">const</span> <span class="kt">void</span> <span class="o">*</span><span class="n">shm_addr</span><span class="p">);</span>

<span class="cm">/*创建共享内存</span>
<span class="cm">成功返回一个共享内存标识符</span>
<span class="cm">以字节为单位指定需要共享的内存容量*/</span>
<span class="kt">int</span> <span class="nf">shmget</span><span class="p">(</span><span class="kt">key_t</span> <span class="n">key</span><span class="p">,</span> <span class="kt">size_t</span> <span class="n">size</span><span class="p">,</span> <span class="kt">int</span> <span class="n">shmflg</span><span class="p">);</span>
</pre></div>
</td></tr></table>

<h3 id="_30">消息队列<a class="headerlink" href="#_30" title="Permanent link">&para;</a></h3>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="cp">#include</span><span class="cpf">&lt;sys/msg.h&gt;</span><span class="cp"></span>

<span class="cm">/**/</span>
<span class="kt">int</span> <span class="nf">msgctl</span><span class="p">(</span><span class="kt">int</span> <span class="n">msqid</span><span class="p">,</span> <span class="kt">int</span> <span class="n">cmd</span><span class="p">,</span> <span class="k">struct</span> <span class="n">msqid_ds</span> <span class="o">*</span><span class="n">buf</span><span class="p">);</span>
<span class="k">struct</span> <span class="n">msqid_ds</span><span class="p">{</span>
        <span class="kt">uid_t</span> <span class="n">msg_perm</span><span class="p">.</span><span class="n">uid</span><span class="p">;</span>
        <span class="kt">uid_t</span> <span class="n">msg_perm</span><span class="p">.</span><span class="n">gid</span><span class="p">;</span>
        <span class="kt">mode_t</span> <span class="n">msg_perm</span><span class="p">.</span><span class="n">mode</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/*创建和访问一个消息队列</span>
<span class="cm">成功时msgget函数返回一个正整数，即标识符，失败返回-1*/</span>
<span class="kt">int</span> <span class="n">msgget</span><span class="p">(</span><span class="kt">key_t</span> <span class="n">key</span><span class="p">,</span> <span class="kt">int</span> <span class="n">msgflg</span><span class="p">);</span>

<span class="cm">/*从一个消息队列中获取消息*/</span>
<span class="kt">int</span> <span class="nf">msgrcv</span><span class="p">(</span><span class="kt">int</span> <span class="n">msqid</span><span class="p">,</span> <span class="kt">void</span> <span class="o">*</span><span class="n">msg_ptr</span><span class="p">,</span> <span class="kt">size_t</span> <span class="n">msg_sz</span><span class="p">,</span> <span class="kt">long</span> <span class="kt">int</span> <span class="n">msgtype</span><span class="p">,</span> <span class="kt">int</span> <span class="n">msgflg</span><span class="p">);</span>

<span class="cm">/*用来把消息添加到消息队列中*/</span>
<span class="kt">int</span> <span class="nf">msgsnd</span><span class="p">(</span><span class="kt">int</span> <span class="n">msqid</span><span class="p">,</span> <span class="k">const</span> <span class="kt">void</span> <span class="o">*</span><span class="n">msg_ptr</span><span class="p">,</span> <span class="kt">size_t</span> <span class="n">msg_sz</span><span class="p">,</span> <span class="kt">int</span> <span class="n">msgflg</span><span class="p">);</span>
<span class="k">struct</span> <span class="n">my_message</span><span class="p">{</span>
        <span class="kt">long</span> <span class="kt">int</span> <span class="n">message_type</span><span class="p">;</span>
        <span class="c1">//data</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>

<h2 id="_31">套接字<a class="headerlink" href="#_31" title="Permanent link">&para;</a></h2>
<p>套接字的3个属性：域(domain)、类型(type)、协议(protocol)。
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="cp">#include</span><span class="cpf">&lt;sys/types.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span><span class="cpf">&lt;sys/socket.h&gt;</span><span class="cp"></span>

<span class="kt">int</span> <span class="nf">socket</span><span class="p">(</span><span class="kt">int</span> <span class="n">domain</span><span class="p">,</span> <span class="kt">int</span> <span class="n">type</span><span class="p">,</span> <span class="kt">int</span> <span class="n">protocol</span><span class="p">);</span>
</pre></div>
</td></tr></table>
|域|说明|
|---|---|
|AF_UNIX|unix域协议(文件系统套接字)|
|AF_INET|ARPA因特网协议(UNIX网络套接字)|</p>
<p>type参数指定套接字的通信特性。它的取值包括SOCK_STREAM和SOCK_DGRAM。</p>
<p>AF_UNIX域套接字地址格式
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="k">struct</span> <span class="n">sockaddr_un</span><span class="p">{</span>
        <span class="n">sa_family_t</span> <span class="n">sun_family</span><span class="p">;</span>
        <span class="kt">char</span> <span class="n">sun_path</span><span class="p">[];</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>
AF_INET域套接字地址格式
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5
6
7
8</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="k">struct</span> <span class="n">sockaddr_in</span><span class="p">{</span>
        <span class="kt">short</span> <span class="kt">int</span> <span class="n">sin_family</span><span class="p">;</span>
        <span class="kt">unsigned</span> <span class="kt">short</span> <span class="kt">int</span> <span class="n">sin_port</span><span class="p">;</span>
        <span class="k">struct</span> <span class="n">in_addr</span> <span class="n">sin_addr</span><span class="p">;</span>
<span class="p">}</span>
<span class="k">struct</span> <span class="n">in_addr</span><span class="p">{</span>
        <span class="kt">unsigned</span> <span class="kt">long</span> <span class="kt">int</span> <span class="n">s_addr</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></p>
<h3 id="_32">命名套接字<a class="headerlink" href="#_32" title="Permanent link">&para;</a></h3>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="cp">#include</span><span class="cpf">&lt;sys/socket.h&gt;</span><span class="cp"></span>
<span class="cm">/*bind系统调用把参数address中的地址分配给与文件描述符socket关联的未命名套接字成功时返回0，失败时返回-1*/</span>
<span class="kt">int</span> <span class="nf">bind</span><span class="p">(</span><span class="kt">int</span> <span class="n">socket</span><span class="p">,</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">sockaddr</span> <span class="o">*</span><span class="n">address</span><span class="p">,</span> <span class="kt">size_t</span> <span class="n">address_len</span><span class="p">);</span>
</pre></div>
</td></tr></table>

<h3 id="_33">创建套接字队列<a class="headerlink" href="#_33" title="Permanent link">&para;</a></h3>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="cp">#include</span><span class="cpf">&lt;sys/socket.h&gt;</span><span class="cp"></span>
<span class="cm">/*listen函数将队列长度设置为backlcg参数的值</span>
<span class="cm">成功返回0，失败返回-1*/</span>
<span class="kt">int</span> <span class="nf">listen</span><span class="p">(</span><span class="kt">int</span> <span class="n">socket</span><span class="p">,</span> <span class="kt">int</span> <span class="n">backlog</span><span class="p">);</span> 
</pre></div>
</td></tr></table>

<h3 id="_34">接受连接<a class="headerlink" href="#_34" title="Permanent link">&para;</a></h3>
<p><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="cp">#include</span><span class="cpf">&lt;sys/socket.h&gt;</span><span class="cp"></span>
<span class="kt">int</span> <span class="nf">accept</span><span class="p">(</span><span class="kt">int</span> <span class="n">socket</span><span class="p">,</span> <span class="k">struct</span> <span class="n">sockaddr</span> <span class="o">*</span><span class="n">address</span><span class="p">,</span> <span class="kt">size_t</span> <span class="o">*</span><span class="n">address_len</span><span class="p">);</span>
</pre></div>
</td></tr></table>
如果套接字队列中没有未处理的连接，accept将阻塞直到客户建立连接为止。可以通过对套接字文件秒速符设置标志来改变这一行为。
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kt">int</span> <span class="n">flags</span><span class="o">=</span><span class="n">fcntl</span><span class="p">(</span><span class="n">socket</span><span class="p">,</span> <span class="n">F_GETFL</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
<span class="n">fcntl</span><span class="p">(</span><span class="n">socket</span><span class="p">,</span> <span class="n">F_SETFL</span><span class="p">,</span> <span class="n">O_NONBLOCK</span><span class="o">|</span><span class="n">flags</span><span class="p">);</span>
</pre></div>
</td></tr></table></p>
<h3 id="_35">请求连接<a class="headerlink" href="#_35" title="Permanent link">&para;</a></h3>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="cp">#include</span><span class="cpf">&lt;sys/socket.h&gt;</span><span class="cp"></span>
<span class="kt">int</span> <span class="nf">connect</span><span class="p">(</span><span class="kt">int</span> <span class="n">socket</span><span class="p">,</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">sockaddr</span> <span class="o">*</span><span class="n">address</span><span class="p">,</span> <span class="kt">size_t</span> <span class="n">address_len</span><span class="p">);</span>    <span class="c1">//成功返回0，失败-1</span>
</pre></div>
</td></tr></table>

<h2 id="_36">主机字节序和网络字节序<a class="headerlink" href="#_36" title="Permanent link">&para;</a></h2>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="cp">#include</span><span class="cpf">&lt;netinet/in.h&gt;</span><span class="cp"></span>
<span class="kt">unsigned</span> <span class="kt">long</span> <span class="kt">int</span> <span class="nf">htonl</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span> <span class="kt">int</span> <span class="n">hostlong</span><span class="p">);</span>
<span class="kt">unsigned</span> <span class="kt">short</span> <span class="kt">int</span> <span class="nf">htons</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">short</span> <span class="kt">int</span> <span class="n">hostshort</span><span class="p">);</span>
<span class="kt">unsigned</span> <span class="kt">long</span> <span class="kt">int</span> <span class="nf">ntohl</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span> <span class="kt">int</span> <span class="n">netlong</span><span class="p">);</span>
<span class="kt">unsigned</span> <span class="kt">long</span> <span class="kt">int</span> <span class="nf">ntohs</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">short</span> <span class="kt">int</span> <span class="n">netshort</span><span class="p">);</span>
</pre></div>
</td></tr></table>

<h3 id="_37">套接字选项<a class="headerlink" href="#_37" title="Permanent link">&para;</a></h3>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="cp">#include</span><span class="cpf">&lt;sys/socket.h&gt;</span><span class="cp"></span>
<span class="kt">int</span> <span class="nf">setsockopt</span><span class="p">(</span><span class="kt">int</span> <span class="n">socket</span><span class="p">,</span> <span class="kt">int</span> <span class="n">level</span><span class="p">,</span> <span class="kt">int</span> <span class="n">option_name</span><span class="p">,</span> <span class="k">const</span> <span class="kt">void</span> <span class="o">*</span><span class="n">option_value</span><span class="p">,</span> <span class="kt">size_t</span> <span class="n">option_len</span><span class="p">);</span>
</pre></div>
</td></tr></table>

<h3 id="select">select系统调用<a class="headerlink" href="#select" title="Permanent link">&para;</a></h3>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="cp">#include</span><span class="cpf">&lt;sys/types.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span><span class="cpf">&lt;sys/time.h&gt;</span><span class="cp"></span>

<span class="kt">void</span> <span class="nf">FD_ZERO</span><span class="p">(</span><span class="n">fd_set</span> <span class="o">*</span><span class="n">fdset</span><span class="p">);</span>    <span class="c1">//将fd_set初始化为空集合</span>
<span class="kt">void</span> <span class="nf">FD_CLR</span><span class="p">(</span><span class="kt">int</span> <span class="n">fd</span><span class="p">,</span> <span class="n">fd_set</span> <span class="o">*</span><span class="n">fdset</span><span class="p">);</span>     <span class="c1">//设置由参数fd传递的文件描述符</span>
<span class="kt">void</span> <span class="nf">FD_SET</span><span class="p">(</span><span class="kt">int</span> <span class="n">fd</span><span class="p">,</span> <span class="n">fd_set</span> <span class="o">*</span><span class="n">fdset</span><span class="p">);</span>     <span class="c1">//清除由参数fd传递的文件描述符</span>
<span class="kt">int</span> <span class="nf">FD_ISSET</span><span class="p">(</span><span class="kt">int</span> <span class="n">fd</span><span class="p">,</span> <span class="n">fd_set</span> <span class="o">*</span><span class="n">fdset</span><span class="p">);</span>    <span class="c1">//参数fd指向的文件描述符是由参数fdset指向的fd_set集合中的一个元素，返回非零值。</span>

<span class="k">struct</span> <span class="n">timeval</span><span class="p">{</span>
        <span class="kt">time_t</span> <span class="n">tv_sec</span><span class="p">;</span>
        <span class="kt">long</span> <span class="n">tv_usec</span><span class="p">;</span>
<span class="p">}</span>       <span class="c1">//设定超时值来防止无限期的阻塞</span>

<span class="cm">/*select调用用于测试文件描述符集合中，是否有一个文件描述符已处于可读状态或可写状态或错误状态，它将阻塞以等待某个文件描述符进入上述这些状态。*/</span>
<span class="kt">int</span> <span class="n">select</span><span class="p">(</span><span class="kt">int</span> <span class="n">nfds</span><span class="p">,</span> <span class="n">fd_set</span> <span class="o">*</span><span class="n">readfds</span><span class="p">,</span> <span class="n">fd_set</span> <span class="o">*</span><span class="n">writefds</span><span class="p">,</span> <span class="n">fd_set</span> <span class="o">*</span><span class="n">errorfds</span><span class="p">,</span> <span class="k">struct</span> <span class="n">timeval</span> <span class="o">*</span><span class="n">timeout</span><span class="p">);</span>
</pre></div>
</td></tr></table>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../linux_base/" title="Linux基础" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  上一页
                </span>
                Linux基础
              </span>
            </div>
          </a>
        
        
          <a href="../../network/plan/" title="规划" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  下一页
                </span>
                规划
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            Copyright &copy; 2018 - 2019 Atticus
          </div>
        
        powered by
        <a href="https://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../assets/javascripts/application.ac79c3b0.js"></script>
      
        
        
          
          <script src="../../assets/javascripts/lunr/lunr.stemmer.support.js"></script>
          
            
              
              
            
          
          
        
      
      <script>app.initialize({version:"1.0.4",url:{base:"../.."}})</script>
      
        <script src="../../_static/js/extra.js?v=15"></script>
      
        <script src="https://cdnjs.loli.net/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML"></script>
      
    
  </body>
</html>